

find_package(Protobuf REQUIRED)

set(PROTOBUF_PACKAGENAME myrobot)

add_custom_command( OUTPUT ${PROTOBUF_PACKAGENAME}.pb.cc ${PROTOBUF_PACKAGENAME}.pb.h
                    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
                    COMMAND protoc --cpp_out=${CMAKE_CURRENT_SOURCE_DIR} ${PROTOBUF_PACKAGENAME}.proto
                    COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_SOURCE_DIR}/${PROTOBUF_PACKAGENAME}.pb.cc ${CMAKE_CURRENT_BINARY_DIR}/${PROTOBUF_PACKAGENAME}.pb.cc 
                    COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_SOURCE_DIR}/${PROTOBUF_PACKAGENAME}.pb.h ${CMAKE_CURRENT_BINARY_DIR}/${PROTOBUF_PACKAGENAME}.pb.h
                    MAIN_DEPENDENCY ${PROTOBUF_PACKAGENAME}.proto
                    )

INSTALL(FILES ${PROTOBUF_PACKAGENAME}.proto DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/protobuf)


add_library(${PROTOBUF_PACKAGENAME}-types 
${PROTOBUF_PACKAGENAME}.pb.cc
)
target_include_directories(${PROTOBUF_PACKAGENAME}-types
	PUBLIC
		$<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
		$<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}>
)

target_link_libraries(${PROTOBUF_PACKAGENAME}-types protobuf)

install(FILES ${CMAKE_CURRENT_SOURCE_DIR}/${PROTOBUF_PACKAGENAME}.pb.h
	DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/${PROTOBUF_PACKAGENAME}/Types
)

install (TARGETS ${PROTOBUF_PACKAGENAME}-types
        EXPORT ${PROTOBUF_PACKAGENAME}-targets
        LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
        RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
)



